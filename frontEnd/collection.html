<!DOCTYPE HTML>
<html>
  <head>
    <title>Hartebeesport Dam Water Hyacinth Monitoring - Collections</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
  </head>
  <body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
      
      <!-- Main -->
      <div id="main">
        <div class="inner">
          <!-- Header -->
          <header id="header">
            <a href="index.html" class="logo"><strong>Hartebeesport Dam </strong>Water Hyacinth Monitoring</a>
            <ul class="icons">
              <li><button onclick="openLogin()" class="button">Login</button></li>
              <li><button onclick="openRegister()" class="button">Register</button></li>
            </ul>
          </header>
          
          <!-- Login/Register Modals -->
          <div id="loginModal" class="login-modal">
            <div class="login-container">
              <span class="close-btn" onclick="closeLogin()">×</span>
              <h2>Login</h2>
              <form id="loginForm">
                <input type="text" id="username" name="username" placeholder="Username" required>
                <input type="password" id="password" name="password" placeholder="Password" required>
                <button type="submit" class="button">Login</button>
              </form>
            </div>
          </div>
          <div id="registerModal" class="login-modal">
            <div class="login-container">
              <span class="close-btn" onclick="closeRegister()">×</span>
              <h2>Register</h2>
              <form id="registerForm">
                <input type="text" id="regUsername" name="regUsername" placeholder="Username" required>
                <input type="email" id="regEmail" name="regEmail" placeholder="Email" required>
                <input type="text" id="regFirstName" name="regFirstName" placeholder="First Name" required>
                <input type="text" id="regLastName" name="regLastName" placeholder="Last Name" required>
                <input type="password" id="regPassword" name="regPassword" placeholder="Password" required>
                <button type="submit" class="button">Register</button>
              </form>
            </div>
          </div>
          
          <!-- Content -->
          <section>
            <header class="main">
              <h1>Collections Management</h1>
            </header>
            <p>Manage collections details. You can add, update, or delete collections.</p>
            
            <!-- Add Collection Form -->
            <section>
              <h2>Add a New Collection</h2>
              <form id="collectionForm">
                <div class="field">
                  <label for="collectionName">Name</label>
                  <input type="text" id="collectionName" name="collectionName" placeholder="Collection Name" required>
                </div>
                <div class="field">
                  <label for="collectionAddress">Address</label>
                  <input type="text" id="collectionAddress" name="collectionAddress" placeholder="Address" required>
                </div>
                <div class="field">
                  <label for="collectionNumber">Number</label>
                  <input type="text" id="collectionNumber" name="collectionNumber" placeholder="Contact Number" required>
                </div>
                <button type="submit" class="button">Add Collection</button>
              </form>
            </section>
            
            <!-- Collections List -->
            <section>
              <h2>All Collections</h2>
              <div class="table-wrapper">
                <table id="collectionsTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Address</th>
                      <th>Number</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Collections will be populated here -->
                  </tbody>
                </table>
              </div>
            </section>
            
            <!-- Update Collection Modal -->
            <div id="updateModal" class="modal">
              <div class="modal-content">
                <span class="close-btn" onclick="closeUpdateModal()">×</span>
                <h2>Update Collection</h2>
                <form id="updateCollectionForm">
                  <input type="hidden" id="updateCollectionId" />
                  <div class="field">
                    <label for="updateCollectionName">Name</label>
                    <input type="text" id="updateCollectionName" required>
                  </div>
                  <div class="field">
                    <label for="updateCollectionAddress">Address</label>
                    <input type="text" id="updateCollectionAddress" required>
                  </div>
                  <div class="field">
                    <label for="updateCollectionNumber">Number</label>
                    <input type="text" id="updateCollectionNumber" required>
                  </div>
                  <button type="submit" class="button">Update Collection</button>
                </form>
              </div>
            </div>
          </section>
        </div>
      </div>
      
      <!-- Sidebar -->
      <div id="sidebar">
        <div class="inner">
          <!-- Search -->
          <section id="search" class="alt">
            <form method="post" action="#">
              <input type="text" name="query" id="query" placeholder="Search" />
            </form>
          </section>
          
          <!-- Menu -->
          <nav id="menu">
            <header class="major">
              <h2>Menu</h2>
            </header>
            <ul>
              <li><a href="index.html">Homepage</a></li>
              <li>
                <span class="opener">Dashboard</span>
                <ul>
                  <li><a href="dashboard.html">Data Insights</a></li>
                  <li><a href="dashboard.html">Monitoring Tools</a></li>
                </ul>
              </li>
              <li>
                <span class="opener">Community</span>
                <ul>
                  <li><a href="#">Forum</a></li>
                  <li><a href="Community Engagement.html#cleanUpEvents">Clean up events</a></li>
                  <li><a href="#">Volunteer</a></li>
                  <li><a href="#">My Volunteer rewards</a></li>
                </ul>
              </li>
              <li>
                <span class="opener">More</span>
                <ul>
                  <li><a href="#">Guides</a></li>
                  <li><a href="#">FAQ</a></li>
                  <li><a href="#">Policy Updates</a></li>
                  <li><a href="#">Contact Us/Help</a></li>
                </ul>
              </li>
              <li><a href="#">Success Stories</a></li>
              <li><a href="#">About Us</a></li>
            </ul>
          </nav>
          
          <!-- Recent Updates -->
          <section>
            <header class="major">
              <h2>Recent Updates</h2>
            </header>
            <div class="mini-posts">
              <article>
                <a href="#" class="image"><img src="images/pic07.jpg" alt="" /></a>
                <p>Recent Data Submission</p>
              </article>
              <article>
                <a href="#" class="image"><img src="images/pic08.jpg" alt="" /></a>
                <p>Community Highlight</p>
              </article>
              <article>
                <a href="#" class="image"><img src="images/pic09.jpg" alt="" /></a>
                <p>Upcoming Cleanup Event</p>
              </article>
            </div>
            <ul class="actions">
              <li><a href="#" class="button">More</a></li>
            </ul>
          </section>
          
          <!-- Get in touch -->
          <section>
            <header class="major">
              <h2>Get in touch</h2>
            </header>
            <p>For inquiries or contributions related to water hyacinth monitoring, please contact our team.</p>
            <ul class="contact">
              <li class="icon solid fa-envelope"><a href="#">info@hartebeesportdamhyacinthProject.org</a></li>
              <li class="icon solid fa-phone">(000) 000-0000</li>
              <li class="icon solid fa-home">Hartebeesport Dam<br />forgot the City, South Africa</li>
            </ul>
          </section>
          
          <!-- Footer -->
          <footer id="footer">
            <p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
          </footer>
        </div>
      </div>
    </div>
    
    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/loginregister.js"></script>
    
    <!-- Collections API JavaScript -->
    <script>
      const BASE_URL = "http://localhost:8080";

      // Fetch and display all collections
      async function getCollections() {
        try {
          const response = await fetch(`${BASE_URL}/collections`);
          if (response.ok) {
            const collections = await response.json();
            const tbody = document.querySelector("#collectionsTable tbody");
            tbody.innerHTML = "";
            collections.forEach(col => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${col.id}</td>
                <td>${col.name}</td>
                <td>${col.address}</td>
                <td>${col.number}</td>
                <td>
                  <button class="button" onclick="openUpdateModal(${col.id})">Update</button>
                  <button class="button" onclick="deleteCollection(${col.id})">Delete</button>
                </td>
              `;
              tbody.appendChild(tr);
            });
          } else {
            alert("Failed to fetch collections.");
          }
        } catch (error) {
          console.error("Error fetching collections:", error);
        }
      }

      // Add a new collection
      document.getElementById("collectionForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        const collection = {
          name: document.getElementById("collectionName").value.trim(),
          address: document.getElementById("collectionAddress").value.trim(),
          number: document.getElementById("collectionNumber").value.trim()
        };
        try {
          const response = await fetch(`${BASE_URL}/collections`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(collection)
          });
          if (response.ok) {
            alert("Collection added successfully!");
            document.getElementById("collectionForm").reset();
            getCollections();
          } else {
            alert("Failed to add collection.");
          }
        } catch (error) {
          console.error("Error adding collection:", error);
        }
      });

      // Delete a collection by ID
      async function deleteCollection(id) {
        if (!confirm("Are you sure you want to delete this collection?")) return;
        try {
          const response = await fetch(`${BASE_URL}/collections/${id}`, {
            method: "DELETE"
          });
          if (response.ok) {
            alert("Collection deleted!");
            getCollections();
          } else {
            alert("Failed to delete collection.");
          }
        } catch (error) {
          console.error("Error deleting collection:", error);
        }
      }

      // Open update modal and populate with collection data
      async function openUpdateModal(id) {
        try {
          const response = await fetch(`${BASE_URL}/collections/${id}`);
          if (response.ok) {
            const col = await response.json();
            document.getElementById("updateCollectionId").value = col.id;
            document.getElementById("updateCollectionName").value = col.name;
            document.getElementById("updateCollectionAddress").value = col.address;
            document.getElementById("updateCollectionNumber").value = col.number;
            document.getElementById("updateModal").style.display = "block";
          } else {
            alert("Failed to fetch collection details.");
          }
        } catch (error) {
          console.error("Error fetching collection:", error);
        }
      }

      // Close the update modal
      function closeUpdateModal() {
        document.getElementById("updateModal").style.display = "none";
      }

      // Handle updating a collection
      document.getElementById("updateCollectionForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        const id = document.getElementById("updateCollectionId").value;
        const updatedCollection = {
          name: document.getElementById("updateCollectionName").value.trim(),
          address: document.getElementById("updateCollectionAddress").value.trim(),
          number: document.getElementById("updateCollectionNumber").value.trim()
        };
        try {
          const response = await fetch(`${BASE_URL}/collections/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updatedCollection)
          });
          if (response.ok) {
            alert("Collection updated successfully!");
            closeUpdateModal();
            getCollections();
          } else {
            alert("Failed to update collection.");
          }
        } catch (error) {
          console.error("Error updating collection:", error);
        }
      });

      // Initialize collections list on page load
      document.addEventListener("DOMContentLoaded", getCollections);
    </script>
  </body>
</html>
